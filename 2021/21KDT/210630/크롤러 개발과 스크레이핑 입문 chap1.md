# 크롤러 개발과 스크레이핑 입문

## 01부 기본편

### Wget으로 시작하는 크롤러 개발

**Wget** : HTTP/FTP사용해서 서버에서 파일을 내려받기 위한 오픈소스 소프트웨어

- 단순하게 파일을 내려받는 용도 외에도 웹 페이지를 재귀적으로 순회하며 내려받거나, HTML 링크를 상대 경로에서 절대 경로로 변환하는 기능도 제공한다.
- 특정 확장자만 내려받거나, 내려받을 간격을 설정하는 기능도 있다.

```bash
$wget <내려받고 싶은 파일의 URL>
$ls  # 내려받은 파일 현재 디렉터리 저장확인
```

내려받을 위치와 파일이름 지정

```bash
$wget -0 <저장하고 싶은 파일 경로와 이름>
```

파일로 저장하지 않고 내려받기

표준 출력으로 출력할 때는 -0 옵션에 파이프*를 지정

```bash
$wget -0 -<내려받고 싶은 파일의 URL>
```

표준 출력으로 출력했을때의 장점은, 

파이프를 사용해 다른 명령어로 내려받은 내용을 넘겨서 처리할 수 있다. 따라서 `Wget`으로 크롤링하고, 다른 명령어로 스크레이핑 할 수 있다.  

- 파이프 : 명령어의 표준 출력을 다음 명령어로 전달하는 처리



### 스크레이핑과 관련된 유닉스 명령어

스크레이핑 : 원하는 데이터를 추출하고 가공하는 것

- 기본 데이터 : 텍스트
- 따라서 텍스트 처리와 관련된 유닉스 명령어는 모두 스크레이핑과 관련돼 있다.

#### grep

grep명령어는 표준 입력 또는 파일에서 패턴에 맞는 줄을 찾아 표준 출력에 출력하는 명령어이다.

자동으로 표준입력을 사용한다.

```bash
$grep <패턴> <파일 이름(여러 개 지정 가능)>
$ps x | grep /usr/libexec/
```

ps x를 사용해 표준 출력에 현재 실행 중인 프로세스를 출력하고, 출력을 grep명령어의 표준 입력으로 받은 뒤 패턴 부분에  /usr/libexec/을 지정해 해당 글자가 있는 줄을 표준 출력에 출력하게 하는것

- ps에 명령어에 x옵션 지정해 현재 실행 중인 프로세스 출력

- 실행 중인 프로세스 중에서 /usr/libexec 과 관련된 프로세스만 추출하려는 명령어

- ps명령어의 결과를 파이프해서 grep명령어에 넘기면 된다.

- /usr/libexec 과 관련된 프로세스가 출력될 것. 이는 파이프를 사용해 ps명령어의 실행 결과를 grep명령어로 넘기고,  /usr/libexec/이 존재하는 줄만 추출할 것.

  

#### Sed

sed명령어는 문자열의 특정 내용을 변경하거나 줄 단위로 데이터를 추출할 때 사용할 수 있다.

파일 이름을 지정하면 해당 파일을 처리하며, 파일 이름을 지정하지 않으면 표준 입력을 기반으로 처리한다.

```bash
$sed <옵션> <명령어> <파일 이름>
```

- 1장: 크롤러
- 2장: HTTP
- 파일 이름 : sample.txt

위에서 `장: ` 을 `장` 으로 변경할때, sed명령어 사용하여 변환

```bash
$sed s/장:/장/ sample.txt
```

- s 명령어 : 변환 처리를 하는 명령어

```bash
$sed s/장:/장/ sample.txt > new_sample.txt
```

sed 명령어의 결과를 파일로 저장하고 싶을 때는 셸의 리다이렉트 기능 사용

sed 등의 명령어 뒤에 `> <파일이름>` 이라고 입력하면 명령어의 결과가 파일로 출력된다.

- 위와 같이 입력시, `new_sample.txt` 라는 파일이 현재 디렉터리에 생성
- 내용 확인시, 이전에 표준 출력에 출력했던 내용이 담겨져 있다.



### 스크레이핑하기

##### 제목을 추출하는 명령어 생각해보기

```bash
<span class="title-text">파이썬으로 배우는 알고리즘 트레이딩 (개정판)</span>
```

`span` 태그 내부에 제목이 들어가 있음.

`sapn` 태그는 단순한 글자를 의미하는 태그. 따라서 단순하게 `span` 태그로 추출하려고 하면 다른 글자도 함께 나올 수 있다.



##### grep명령어로 제목 추출하기

이 `span` 태그에는 `class` 속성으로 `"title-text"` 가 지정돼 있다.

이전에 `wget` 명령어로 내려받은 디렉토리로 이동하고, 다음 명령어 입력

```bash
$cd wikibook.co.kr
$grep class=\"title-text\" index.html
```

책의 제목이 들어있는 부분 추출할 수 있다.

- `<span class="title-text">파이썬으로 배우는 알고리즘 트레이딩 (개정판)</span>`

제목 글자만 추출시 `sed` 명령어 사용

```bash
$grep class=\"title-text\" index.html | sed 's/.*\"title-text\">//'
```

- `파이썬으로 배우는 알고리즘 트레이딩 (개정판)</span>`

뒤에 있는 </span> 제거시, 다음과 같은 방법으로 문자 제거

```bash
$grep class=\"title-text\" index.html | sed 's/.*\"title-text\">//;s/<\/span>//'
```

- `파이썬으로 배우는 알고리즘 트레이딩 (개정판)`

제목 부분만 추출