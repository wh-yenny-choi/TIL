# SQL 응용

## DDL(Data Define Language)

DDL(데이터 정의어)는 DB구조, 데이터  형식, 접근 방식 등 DB를 구축하거나 수정할 목적으로 사용하는 언어이다.

- DDL은 번역한 결과가 데이터 사전(Data Dictionary)라는 특별한 파일에 여러 개의 테이블로서 저장된다.
- DDL에는 create schema, create domain, create table, create view, create index, alter table, drop등이 있다.

### CREATE SCHEMA



## DCL(Data Control Language)

DCL(데이터 제어어)는 데이터의 보안, 무결성, 회복, 병행 제어 등을 정의하는데 사용하는 언어이다.

- DCL은 데이터베이스관리자(DBA)가 데이터 관리를 목적으로 사용한다.
- DCL에는 grant, revoke, commit, rollback, savepoint 등이 있다.



## DML(Data Manipulation Language)

DML(데이터 조작어)는 데이터베이스 사용자가 응용 프로그램이나 질의어를 통해 데이터를 실질적으로 관리하는데 사용되는 언어이다.

- DML은 데이터베이스 사용자와 데이터베이스 관리 시스템 간의 인터페이스를 제공한다.

- DML의 유형

  | 명령문 | 기능                        |
  | ------ | --------------------------- |
  | SELECT | 테이블에서 튜플을 검색      |
  | INSERT | 테이블에 새로운 튜플 삽입   |
  | DELETE | 테이블에서 튜플 삭제        |
  | UPDATE | 테이블에서 튜플의 내용 갱신 |

  

SELECT-1

SELECT-2

## 프로시저 (Procedure)

프로시저란 절차형 SQL을 활용하여 특정 기능을 수행하는 일종의 트랜잭션언어로 호출을 통해 실행되어 미리 저장해 놓은 SQL 작업을 수행

- 프로시저를 만들어 데이터베이스에 저장하면 여러 프로그램에서 호출하여 사용할 수 있다.
- 프로시저는 데이터 베이스에 저장되어 수행되기 때문에 스토어드(stored) 프로시저라고도 불린다.
- 프로시저는 시스템의 일일 마감 작업, 일괄(Batch) 작업 등에 주로 사용된다.

**+**

- 절차형 SQL : C, Java등의 프로그래밍 언어와 같이 연속적인 실행이나, 분기, 반복 등의 제어가 가능한 SQL을 의미한다
- 트랜잭션 언어 : 데이터베이스를 조작하고 트랜잭션을 처리하는 언어로, SQL과 TCL이 트랜잭션 언어에 속한다.



## 트리거 (Trigger)

트리거는 데이터베이스 스스템에서 데이터의 삽입, 갱신, 삭제 등의 이벤트가 발생할 때마다 관련 작업이 자동으로 수행되는 절차형 SQL이다.

- 트리거는 데이터베이스에 저장되며, 데이터 변경 및 무결성 유지, 로그 메시지 출력 등의 목적으로 사용된다.
- 트리거의 구문에는 DCL(데이터 제어어)을 사용할 수 없으며, DCL(grant, revoke, commit, rollback, savepoint···) 이 포함된 프로시저나 함수를 호출하는 경우에도 오류가 발생한다.
- 트리거에 오류가 있는 경우 트리거가 처리하는 데이터에도 영향을 미치므로 트리거를 생성할 때 세심한 주의가 필요하다.



## 사용자 정의 함수

사용자 정의 함수는 프로시저와 유사하게 SQL을 사용하여 일련의 작업을 연속적으로 처리하며, 종료 시 처리 결과를 단일값으로 반환하는 절차형 SQL이다.

- 사용자 정의 함수는 데이터베이스에 저장되어 select, insert, delete, update 등 DML문의 호출에 의해 실행된다.
- 사용자 정의 함수는 예약어 RETURN을 통해 값을 반환하기 때문에 출력 파라미터가 없다.
- 사용자 정의 함수는 insert, delete, update를 통한 테이블 조작은 할 수 없고, select를 통한 조회만 할 수 있다.
- 사용자 정의 함수는 프로시저를 호출하여 사용할 수 없다.
- 사용자 정의 함수는 SUM(), AVG() 등의 내장 함수처럼 DML문에서 반환값을 활용하기 위한 용도로 사용된다.

**+**

- 매개변수(**parameter**)란 함수의 정의에서 전달받은 인수를 함수 내부로 전달하기 위해 사용하는 변수를 의미 (def?)



### 프로시저 vs 사용자 정의 함수

| 구분             | 프로시저                   | 사용자 정의 함수 |
| ---------------- | -------------------------- | ---------------- |
| 반환값           | 없거나 1개 이상 가능       | 1개              |
| 파라미터         | 입·출력 가능               | 입력만 가능      |
| 사용 가능 명령문 | DML, DCL                   | SELECT           |
| 호출             | 프로시저, 사용자 정의 함수 | 사용자 정의 함수 |
| 사용 방법        | 실행문                     | DML에 포함       |



## 제어문

절차형 SQL은 '절차형'이라는 말 그대로 SQL명령어가 서술된 순서에 따라 위에서 아래로 차례대로 실행되는데, 제어문은 이러한 진행 순서를 변경하기 위해 사용하는 명령문이다.

- 제어문의 종류에는 IF, LOOP, GOTO 등이 있다.



## 커서(Cursor)

커서는 쿼리문의 처리 결과가 저장되어 있는 메모리 공간을 가리키는 포인터(Pointer)아더,

- 커서는 내부에서 자동으로 생성되어 사용되는 **묵시적 커서**와, 사용자가 직접 정의해서 쓰는 **명시적 커서**가 있다.
- 커서의 수행은 열기(Open), 패치(Fetch), 닫기(Close)의 세 단계로 진행된다.
- **묵시적 커서**는 수행된 쿼리문의 정상적인 수행 여부를 확인하기위해 사용되며, **명시적 커서**는 쿼리문의 결과를 저장하여 사용함으로써 동일한 쿼리가 반복 수행되어 데이터베이스 자원이 낭비되는 것을 방지한다.
